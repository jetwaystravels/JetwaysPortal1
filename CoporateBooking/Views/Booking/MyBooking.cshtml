@model List<Booking>

<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Title  -->
    <title>Jetways Travels</title>
    <!-- Favicon  -->
    <link rel="icon" href="~/img/favicon.png">
    <!-- Style css -->
    <link rel="stylesheet" href="~/css/vendors.css">
    <link rel="stylesheet" href="~/css/main.css">
    <link rel="stylesheet" href="~/css/style.css">
    <link rel="stylesheet" href="~/css/daterangepicker.css">

</head>
<body>
    <main>
        <!-- ***** Header Start ***** -->
        <header class="navbar navbar-sticky navbar-expand-lg inner-bg">
            <div class="container position-relative">
                <a class="navbar-brand" asp-controller="FlightSearchIndex" asp-action="Index">
                    <img class="navbar-brand-regular" src="~/img/logo/logo.png" alt="brand-logo">
                    <img class="navbar-brand-sticky" src="~/img/logo/logo.png" alt="sticky brand-logo">
                </a>
                <button class="navbar-toggler d-lg-none" type="button" data-toggle="navbarToggler" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="navbar-inner">
                    <!--  Mobile Menu Toggler -->
                    <button class="navbar-toggler d-lg-none" type="button" data-toggle="navbarToggler" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="nav-bar col-12 col-md-7 col-lg-12">
                        <ul class="nav nav-pills" id="pills-tab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-1.png">Flight</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill"><img class="mr-2" src="~/img/nav-icon-2.png">Hotel</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-3.png">Visa</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-4.png">Holidays</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-5.png">Trains</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-6.png">Buses</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill"><img class="mr-2" src="~/img/nav-icon-7.png">Cabs</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-8.png">Flight Passes</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"><img class="mr-2" src="~/img/nav-icon-8.png">Login</a>
                            </li>
                        </ul>
                    </div>
                    <nav id="mobile-nav">
                        <ul class="navbar-nav" id="navbar-nav">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#">
                                    Home
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link scroll" href="features">Features</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#">
                                    Pages
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link scroll" href="#">Screenshots</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link scroll" href="#">Pricing</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link scroll" href="#">Contact</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>
        <!-- ***** Header End ***** -->
        <!-- ***** Start inner search ***** -->
        <div class="inner-search" style="padding:0; height: 264px; width: 100%;">
            <img class="navbar-brand-regular" src="~/img/flight-bg-img.jpg" alt="bannerimge" style="opacity: 0.8;">
        </div>
        <!-- ***** End inner search ***** -->


        <section class="layout-pb-md bg-light-2 m-booking">
            <div class="container top-bx">
                <ul class="nav nav-pills" id="pills-tab" role="tablist">
                    <li class="nav-item">
                        @{
                            int ActiveTrip = Model.Where(x => x.cancelstatus == 0 && x.DepartureDate >= DateTime.Today).Count();
                            int CancelTrip = Model.Where(x => x.cancelstatus == 3).Count();
                            int CompleteTrip = Model.Where(x => x.cancelstatus != 3 && x.DepartureDate < DateTime.Today).Count();


                        }
                        <a class="nav-link active" id="pills-trip-tab" data-toggle="pill" href="#pills-trip">Trip<span>@ActiveTrip Active Trip</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="pills-Cancelled-tab" data-toggle="pill" href="#pills-Cancelled">Cancelled/Refunded<span>@CancelTrip Cancelled</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="pills-Completed-tab" data-toggle="pill" href="#pills-Completed">Completed<span>@CompleteTrip Check Previous Trips</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="pills-Unsuccessful-tab" data-toggle="pill" href="#pills-Unsuccessful">Unsuccessful<span>Check Pending Trips</span></a>
                    </li>
                    <li class="nav-item">
                        <section id="search">
                            <label for="search-input"><i class="fa fa-search" aria-hidden="true"></i><span class="sr-only">Search Booking</span></label>
                            <input id="search-input" class="form-control input-lg" placeholder="Search Booking" autocomplete="off" spellcheck="false" autocorrect="off" tabindex="1">

                        </section>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="pills-trip">
                        @* <div class="text-center">
                                <img class="navbar-brand-regular" src="~/img/booking-not-img.jpg" alt="image">
                                <p class="text-center"><strong>Currently You Have No Bookings.</strong></p>
                            </div> *@

                        <div class="text-center">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Trip ID</th>
                                        <th>Travel Date/Time</th>
                                        <th>PNR Number</th>
                                        <th>Traveller Details</th>
                                        <th>Trip Details</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                @* <tbody>
                                    @if (Model != null && Model.Count > 0)
                                    {
                                    foreach(Booking books in Model.Where(x=>  x.cancelstatus == 0 && x.DepartureDate >= DateTime.Today ).ToList())
                                    {
                                    <tr>
                                                <td> img @books.AirLineID- @books.FlightID</td>
                                            <td><strong>@Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM")</strong>-@Convert.ToDateTime(books.DepartureDate).ToString("yyyy"),<strong>@Convert.ToDateTime(books.DepartureDate).ToString("HH:mm")</strong> </td>

                                            <td>@books.RecordLocator</td>
                                            <td>@books.Passengers <br /><small>Jetways Travels</small></td>
                                        <td>
                                                Domestic @books.TripType (Online)<br />
                                                @Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM-yyyy, HH:MM") @books.Origin to @books.Destination |<br />
                                                @books.Segments | PNR: @books.RecordLocator
                                        </td>
                                        <td class="status-booked" style="color:#008000;"><i class="fa fa-check-circle" aria-hidden="true"></i>Booked</td>
                                        <td>
                                            <div class="booking-row">

                                                <!-- Cancel Button Form -->
                                                    <form asp-controller="Booking" asp-action="Cancelbooking" class="d-inline" asp-route-pnr="@books.RecordLocator" asp-route-airline="@books.AirLineID" method="post">
                                                    @Html.AntiForgeryToken()
                                                    <button type="submit" class="cancel-btn action-btn"
                                                            style="color: #fff; border: #ddd 1px solid; background: #EF0000;">
                                                        Manage Bookig
                                                    </button>
                                                </form>

                                                <!-- Reschedule Button Form -->
                                                <form asp-controller="Booking" asp-action="RescheduleAction" method="post" class="d-inline">
                                                    @Html.AntiForgeryToken()
                                                    <button type="submit" class="cancel-btn action-btn"
                                                            style="color: #fff; border: #ddd 1px solid; background: #FF4B33;">
                                                        Reschedule
                                                    </button>
                                                </form>

                                            </div>
                                        </td>

                                    </tr>
                                    }
                                    }
                                </tbody> *@

                                <tbody>
                                    @if (Model != null && Model.Count > 0)
                                    {
                                        foreach (Booking books in Model.Where(x => x.cancelstatus == 0 && x.DepartureDate >= DateTime.Today).ToList())
                                        {
                                            <tr>
                                                <td class="text-center trip-id">
                                                    @{
                                                        string imagePath = books.AirLineID switch
                                                        {
                                                            1 => Url.Content("~/img/flight-logo-icon/AIX_X_Logo_Orange.png"),
                                                            2 => Url.Content("~/img/flight-logo-icon/akasa.png"),
                                                            3 => Url.Content("~/img/flight-logo-icon/SG.png"),
                                                            4 => Url.Content("~/img/flight-logo-icon/6E.png"),
                                                            5 => Url.Content("~/img/flight-logo-icon/airindia.png"),
                                                            _ => Url.Content("~/images/airlines/default.png")
                                                        };
                                                    }
                                                    <img src="@imagePath" alt="Airline Logo" style="height: 30px;" />
                                                    @books.FlightID
                                                </td>

                                                <td class="travel-date">
                                                    <strong>@Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM")</strong> -
                                                    @Convert.ToDateTime(books.DepartureDate).ToString("yyyy"),
                                                    <strong>@Convert.ToDateTime(books.DepartureDate).ToString("HH:mm")</strong>
                                                </td>

                                                <td class="pnr-no">@books.RecordLocator</td>

                                                <td class="trv-dtl">
                                                    @books.Passengers <br />
                                                    <small>Jetways Travels</small>
                                                </td>

                                                <td class="trp-dtl">
                                                    Domestic @books.TripType (Online)<br />
                                                    @Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM-yyyy, HH:mm") @books.Origin to @books.Destination |<br />
                                                    @books.Segments | PNR: @books.RecordLocator
                                                </td>

                                                <td class="status-booked status" style="color:#008000;">
                                                    <i class="fa fa-check-circle" aria-hidden="true"></i> Booked
                                                </td>

                                                <td class="action">
                                                    <div class="booking-row">
                                                        <!-- Cancel Button Form -->
                                                        <form asp-controller="Booking" asp-action="Cancelbooking" class="d-inline"
                                                              asp-route-pnr="@books.RecordLocator" asp-route-airline="@books.AirLineID" method="post">
                                                            @Html.AntiForgeryToken()
                                                            <button type="submit" class="cancel-btn action-btn"
                                                                    style="color: #fff; border: #ddd 1px solid; background: #EF0000;">
                                                                Manage Booking
                                                            </button>
                                                        </form>

                                                        <!-- Reschedule Button Form -->
                                                        @*  <form asp-controller="Booking" asp-action="RescheduleAction" method="post" class="d-inline">
                                                            @Html.AntiForgeryToken()
                                                            <button type="submit" class="cancel-btn action-btn"
                                                                    style="color: #fff; border: #ddd 1px solid; background: #FF4B33;">
                                                                Reschedule
                                                            </button>
                                                        </form> *@
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-Cancelled">
                        <div class="text-center">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Trip ID</th>
                                        <th>Travel Date/Time</th>
                                        <th>PNR Number</th>
                                        <th>Traveller Details</th>
                                        <th>Trip Details</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    @if (Model != null && Model.Count > 0)
                                    {
                                        @* if(Model[0].) *@
                                        foreach (Booking books in Model.Where(x => x.cancelstatus == 3).ToList())
                                        {
                                            <tr>
                                                <td class="text-center trip-id">
                                                    @{
                                                        string imagePath = books.AirLineID switch
                                                        {
                                                            1 => Url.Content("~/img/flight-logo-icon/AIX_X_Logo_Orange.png"),
                                                            2 => Url.Content("~/img/flight-logo-icon/akasa.png"),
                                                            3 => Url.Content("~/img/flight-logo-icon/SG.png"),
                                                            4 => Url.Content("~/img/flight-logo-icon/6E.png"),
                                                            5 => Url.Content("~/img/flight-logo-icon/airindia.png"),
                                                            _ => Url.Content("~/images/airlines/default.png")
                                                        };
                                                    }
                                                    <img src="@imagePath" alt="Airline Logo" style="height: 30px;" />
                                                    @books.FlightID
                                                </td>
                                                <td class="travel-date"><strong>@Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM")</strong>-@Convert.ToDateTime(books.DepartureDate).ToString("yyyy"),<strong>@Convert.ToDateTime(books.DepartureDate).ToString("HH:mm")</strong> </td>

                                                <td>@books.RecordLocator</td>
                                                <td>@books.Passengers <br /><small>Jetways Travels</small></td>
                                                <td>
                                                    Domestic @books.TripType (Online)<br />
                                                    @Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM-yyyy, HH:MM") @books.Origin to @books.Destination |<br />
                                                    @books.Segments | PNR: @books.RecordLocator
                                                </td>
                                                <td class="status">
                                                    <button class="status-booked" onclick="return ViewRefundData('@books.FlightID' , '@books.RecordLocator')" style="color:#008000;"><i class="fa fa-check-circle" aria-hidden="true"></i>View Refund</button>
                                                    <div class="popbx" id="popbx-@books.FlightID" style="display: none;">
                                                        <button class="close-btn " onclick="closeRefundPopup('@books.FlightID')">&times;</button>

                                                        <table class="table">
                                                            <tbody>
                                                                <tr>
                                                                    <th><strong>Booking Amount:</strong></th>
                                                                    <td><div id="@books.FlightID"></div></td>
                                                                </tr>
                                                                <tr>
                                                                    <th><strong>Deduction Amount:</strong></th>
                                                                    <td><div id="@books.FlightID"></div></td>
                                                                </tr>
                                                                <tr>
                                                                    <th><strong>Refund Amount:</strong></th>
                                                                    <td><div id="@books.FlightID"></div></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>

                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-Completed">
                        <div class="text-center">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Trip ID</th>
                                        <th>Travel Date/Time</th>
                                        <th>PNR Number</th>
                                        <th>Traveller Details</th>
                                        <th>Trip Details</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    @if (Model != null && Model.Count > 0)
                                    {
                                        @* if(Model[0].) *@
                                        foreach (Booking books in Model.Where(x => x.cancelstatus != 3 && x.DepartureDate < DateTime.Today).ToList())
                                        {
                                            <tr>
                                                <td class="text-center trip-id">
                                                    @{
                                                        string imagePath = books.AirLineID switch
                                                        {
                                                            1 => Url.Content("~/img/flight-logo-icon/AIX_X_Logo_Orange.png"),
                                                            2 => Url.Content("~/img/flight-logo-icon/akasa.png"),
                                                            3 => Url.Content("~/img/flight-logo-icon/SG.png"),
                                                            4 => Url.Content("~/img/flight-logo-icon/6E.png"),
                                                            5 => Url.Content("~/img/flight-logo-icon/airindia.png"),
                                                            _ => Url.Content("~/images/airlines/default.png")
                                                        };
                                                    }
                                                    <img src="@imagePath" alt="Airline Logo" style="height: 30px;" />
                                                    @books.FlightID
                                                </td>
                                                <td class="travel-date"><strong>@Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM")</strong>-@Convert.ToDateTime(books.DepartureDate).ToString("yyyy"),<strong>@Convert.ToDateTime(books.DepartureDate).ToString("HH:mm")</strong> </td>

                                                <td class="pnr-no">@books.RecordLocator</td>
                                                <td class="trv-dtl">@books.Passengers <br /><small>Jetways Travels</small></td>
                                                <td class="trp-dtl">
                                                    Domestic @books.TripType (Online)<br />
                                                    @Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM-yyyy, HH:MM") @books.Origin to @books.Destination |<br />
                                                    @books.Segments | PNR: @books.RecordLocator
                                                </td>

                                                <td class="status-awaiting status" style="color:#EF0000;"><i class="fa fa-times-circle" aria-hidden="true"></i>Complete</td>

                                            </tr>
                                        }
                                    }



                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-Unsuccessful">
                        <div class="text-center">
                            <img class="navbar-brand-regular" src="~/img/booking-not-img.jpg" alt="image" style="height: 250px;">
                            <p class="text-center"><strong>Currently You Have No Bookings.</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- ***** All jQuery Plugins ***** -->
    <!-- Social media js -->
    <script src="~/js/jquery/jquery.min.js"></script>
    <!-- Plugins js -->
    <script src="~/js/plugins/plugins.min.js"></script>

    <!-- ***** Clander js ***** -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>
    <script src="~/js/daterangepicker.js"></script>

    <!-- Bootstrap js -->
    <script src="~/js/bootstrap/popper.min.js"></script>
    <script src="~/js/bootstrap/bootstrap.min.js"></script>
    <!-- Travellers js -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAAz77U5XQuEME6TpftaMdX0bBelQxXRlM"></script>
    <script src="~/js/vendors.js"></script>
    <script src="~/js/main.js"></script>

    <!-- Active js -->
    <script src="~/js/active.js"></script>

    <!-- Clander js -->
    <script type="text/javascript">
        $(document).ready(function () {
            updateConfig();
            function updateConfig() {
                var options = {};
                if ($('#locale').is(':checked')) {
                    $('#rtl-wrap').show();
                    options.locale = {
                        daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
                        monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                        firstDay: 1
                    };
                }

                $('#start-date').daterangepicker(options, function (start, end, label) { console.log('New date range selected: ' + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD') + ' (predefined range: ' + label + ')'); }).click();;

            }

        });

            < !--show and hide-- >

            $('.showBtn').click(function () {
                //$('.hideme').hide();
                if ($(this).hasClass('active')) {
                    $(this).removeClass('active');
                    $('.hideme').slideUp(1);
                } else {
                    $('.hideme').slideUp(1);
                    $('.showBtn').removeClass('active');
                    $(this).addClass('active');
                    $(this).next().filter('.hideme').slideDown(1);
                }
            });

    </script>


    <script>
        $(document).ready(function () {
            $('#filter-one').on('click', function () {
                $(this).toggleClass('slotSelected');
            });

            $('#filter-two').on('click', function () {
                $(this).toggleClass('slotSelected');
            });

            $('#filter-three').on('click', function () {
                $(this).toggleClass('slotSelected');
            });

            $('#filter-four').on('click', function () {
                $(this).toggleClass('slotSelected');
            });

        });
    </script>


    <!-- My booking Search Filter Script -->
    <script>
        $(document).ready(function () {
            $('#search-input').on('keyup', function () {
                var searchText = $(this).val().toLowerCase();
                var activeTab = $('.tab-pane.active');

                activeTab.find('tbody tr').each(function () {
                    var rowText = $(this).text().toLowerCase();
                    $(this).toggle(rowText.indexOf(searchText) > -1);
                });
            });

            // Refresh search results when tab changes
            $('a[data-toggle="pill"]').on('shown.bs.tab', function () {
                $('#search-input').trigger('keyup');
            });
        });
    </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    @* <script>
        function ViewRefundData(id, pnr) {
            $.ajax({
                url: "/CancelBooking/CancelRefund?fid=" + encodeURIComponent(id) + "&p=" + encodeURIComponent(pnr),
                type: "GET",
                contentType: "application/json",
                success: function (data) {
                    console.log("Refund Data:", data);
                    document.getElementById(id).innerHTML = "<span>" + data.amount + "</span><span>" + pnr + "</span>";
                    // You can update the DOM here with returned data if needed
                },
                error: function (xhr, status, error) {
                    console.error("Error:", error);
                }
            });
        }
    </script> *@


    <script>
        function ViewRefundData(id, pnr) {
            // Show the pop-up box
            document.getElementById("popbx-" + id).style.display = "block";

            $.ajax({
                    url: "/CancelBooking/CancelRefund?fid=" + encodeURIComponent(id) + "&p=" + encodeURIComponent(pnr),
                    type: "GET",
                    contentType: "application/json",
                    success: function (data) {
                        console.log("Refund Data:", data);
                        document.getElementById(id).innerHTML = "<span>" + data.amount + "</span><span>" + pnr + "</span>";
                        // You can update the DOM here with returned data if needed
                    },
                    error: function (xhr, status, error) {
                        console.error("Error:", error);
                    }
                });
            }

            function closeRefundPopup(id) {
            document.getElementById("popbx-" + id).style.display = "none";
        }
    </script>

</body>



</html>