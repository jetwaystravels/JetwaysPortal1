@model List<Booking>

<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Title  -->
    <title>Jetways Travels</title>
    <!-- Favicon  -->
    <link rel="icon" href="~/img/favicon.png">
    <!-- Style css -->
    <link rel="stylesheet" href="~/css/vendors.css">
    <link rel="stylesheet" href="~/css/main.css">
    <link rel="stylesheet" href="~/css/style.css">
    <link rel="stylesheet" href="~/css/daterangepicker.css">

</head>
<body>
    <main>
        <!-- ***** Header Start ***** -->
        <header class="navbar navbar-sticky navbar-expand-lg inner-bg">
            <div class="container position-relative">
                <a class="navbar-brand" asp-controller="FlightSearchIndex" asp-action="Index">
                    <img class="navbar-brand-regular" src="~/img/logo/logo.png" alt="brand-logo">
                    <img class="navbar-brand-sticky" src="~/img/logo/logo.png" alt="sticky brand-logo">
                </a>
                <button class="navbar-toggler d-lg-none" type="button" data-toggle="navbarToggler" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="navbar-inner">
                    <!--  Mobile Menu Toggler -->
                    <button class="navbar-toggler d-lg-none" type="button" data-toggle="navbarToggler" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="nav-bar col-12 col-md-7 col-lg-12">
                        <ul class="nav nav-pills" id="pills-tab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-1.png">Flight</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill"><img class="mr-2" src="~/img/nav-icon-2.png">Hotel</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-3.png">Visa</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-4.png">Holidays</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-5.png">Trains</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-6.png">Buses</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill"><img class="mr-2" src="~/img/nav-icon-7.png">Cabs</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="pill" href="#"><img class="mr-2" src="~/img/nav-icon-8.png">Flight Passes</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"><img class="mr-2" src="~/img/nav-icon-8.png">Login</a>
                            </li>
                        </ul>
                    </div>
                    <nav id="mobile-nav">
                        <ul class="navbar-nav" id="navbar-nav">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#">
                                    Home
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link scroll" href="features">Features</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#">
                                    Pages
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link scroll" href="#">Screenshots</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link scroll" href="#">Pricing</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link scroll" href="#">Contact</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>
        <!-- ***** Header End ***** -->
        <!-- ***** Start inner search ***** -->
        <div class="inner-search" style="padding:0; height: 264px; width: 100%;">
            <img class="navbar-brand-regular" src="~/img/flight-bg-img.jpg" alt="bannerimge" style="opacity: 0.8;">
        </div>
        <!-- ***** End inner search ***** -->


        @{
            if (ViewBag.Message != null)
            {
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <strong>Success!</strong> @ViewBag.Message
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            }

        }

        <section class="layout-pb-md bg-light-2 m-booking">
            <div class="container top-bx">
                <ul class="nav nav-pills" id="pills-tab" role="tablist">
                    <li class="nav-item">
                        @{
                            int ActiveTrip = Model.Where(x => x.cancelstatus == 0 && x.DepartureDate >= DateTime.Today).Count();
                            int CancelTrip = Model.Where(x => x.cancelstatus == 3).Count();
                            int CompleteTrip = Model.Where(x => x.cancelstatus != 3 && x.DepartureDate < DateTime.Today).Count();


                        }
                        <a class="nav-link active" id="pills-trip-tab" data-toggle="pill" href="#pills-trip">Trip<span>@ActiveTrip Active Trip</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="pills-Cancelled-tab" data-toggle="pill" href="#pills-Cancelled">Cancelled/Refunded<span>@CancelTrip Cancelled</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="pills-Completed-tab" data-toggle="pill" href="#pills-Completed">Completed<span>@CompleteTrip Check Previous Trips</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="pills-Unsuccessful-tab" data-toggle="pill" href="#pills-Unsuccessful">Unsuccessful<span>Check Pending Trips</span></a>
                    </li>
                    <li class="nav-item">
                        <section id="search">
                            <label for="search-input"><i class="fa fa-search" aria-hidden="true"></i><span class="sr-only">Search Booking</span></label>
                            <input id="search-input" class="form-control input-lg" placeholder="Search Booking" autocomplete="off" spellcheck="false" autocorrect="off" tabindex="1">

                        </section>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="pills-trip">
                        @* <div class="text-center">
                                <img class="navbar-brand-regular" src="~/img/booking-not-img.jpg" alt="image">
                                <p class="text-center"><strong>Currently You Have No Bookings.</strong></p>
                            </div> *@

                        <div class="text-center">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Trip ID</th>
                                        <th>Travel Date/Time</th>
                                        <th>PNR Number</th>
                                        <th>Traveller Details</th>
                                        <th>Trip Details</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                

                                <tbody>
                                    @if (Model != null && Model.Count > 0)
                                    {
                                        foreach (Booking books in Model.Where(x => x.cancelstatus == 0 && x.DepartureDate >= DateTime.Today).ToList())
                                        {
                                            <tr>
                                                <td class="text-center trip-id">
                                                    @{
                                                        string imagePath = books.AirLineID switch
                                                        {
                                                            1 => Url.Content("~/img/flight-logo-icon/AIX_X_Logo_Orange.png"),
                                                            2 => Url.Content("~/img/flight-logo-icon/akasa.png"),
                                                            3 => Url.Content("~/img/flight-logo-icon/SG.png"),
                                                            4 => Url.Content("~/img/flight-logo-icon/6E.png"),
                                                            5 => Url.Content("~/img/flight-logo-icon/airindia.png"),
                                                            _ => Url.Content("~/images/airlines/default.png")
                                                        };
                                                    }
                                                    <img src="@imagePath" alt="Airline Logo" style="height: 30px;" />
                                                    @books.FlightID
                                                </td>

                                                <td class="travel-date">
                                                    <strong>@Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM")</strong> -
                                                    @Convert.ToDateTime(books.DepartureDate).ToString("yyyy"),
                                                    <strong>@Convert.ToDateTime(books.DepartureDate).ToString("HH:mm")</strong>
                                                </td>

                                                <td class="pnr-no">@books.RecordLocator</td>

                                                <td class="trv-dtl">
                                                    @books.Passengers <br />
                                                    <small>Jetways Travels</small>
                                                </td>

                                                <td class="trp-dtl">
                                                    Domestic @books.TripType (Online)<br />
                                                    @Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM-yyyy, HH:mm") @books.Origin to @books.Destination |<br />
                                                    @books.Segments | PNR: @books.RecordLocator
                                                </td>

                                                <td class="status-booked status" style="color:#008000;">
                                                    <i class="fa fa-check-circle" aria-hidden="true"></i> Booked
                                                </td>

                                                <td class="action">
                                                    <div class="booking-row">
                                                        <!-- Cancel Button Form -->
                                                        <form asp-controller="Booking" asp-action="Cancelbooking" class="d-inline"
                                                              asp-route-brid="@books.BookingRelationId" asp-route-pnr="@books.RecordLocator" asp-route-airline="@books.AirLineID" method="post">
                                                            @Html.AntiForgeryToken()
                                                            <button type="submit" class="cancel-btn action-btn"
                                                                    style="color: #fff; border: #ddd 1px solid; background: #EF0000;">
                                                                Manage Booking
                                                            </button>
                                                        </form>

                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-Cancelled">
                        <div class="text-center">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Trip ID</th>
                                        <th>Travel Date/Time</th>
                                        <th>PNR Number</th>
                                        <th>Traveller Details</th>
                                        <th>Trip Details</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    @if (Model != null && Model.Count > 0)
                                    {
                                        @* if(Model[0].) *@
                                        foreach (Booking books in Model.Where(x => x.cancelstatus == 3).ToList())
                                        {
                                            <tr>
                                                <td class="text-center trip-id">
                                                    @{
                                                        string imagePath = books.AirLineID switch
                                                        {
                                                            1 => Url.Content("~/img/flight-logo-icon/AIX_X_Logo_Orange.png"),
                                                            2 => Url.Content("~/img/flight-logo-icon/akasa.png"),
                                                            3 => Url.Content("~/img/flight-logo-icon/SG.png"),
                                                            4 => Url.Content("~/img/flight-logo-icon/6E.png"),
                                                            5 => Url.Content("~/img/flight-logo-icon/airindia.png"),
                                                            _ => Url.Content("~/images/airlines/default.png")
                                                        };
                                                    }
                                                    <img src="@imagePath" alt="Airline Logo" style="height: 30px;" />
                                                    @books.FlightID
                                                </td>
                                                <td class="travel-date"><strong>@Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM")</strong>-@Convert.ToDateTime(books.DepartureDate).ToString("yyyy"),<strong>@Convert.ToDateTime(books.DepartureDate).ToString("HH:mm")</strong> </td>

                                                <td>@books.RecordLocator</td>
                                                <td>@books.Passengers <br /><small>Jetways Travels</small></td>
                                                <td>
                                                    Domestic @books.TripType (Online)<br />
                                                    @Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM-yyyy, HH:MM") @books.Origin to @books.Destination |<br />
                                                    @books.Segments | PNR: @books.RecordLocator
                                                </td>
                                                <td class="status">
                                                    <button class="status-booked" onclick="return OldViewRefundData('@books.FlightID' , '@books.RecordLocator')" style="color:#008000;"><i class="fa fa-check-circle" aria-hidden="true"></i>View Refund</button>
                                                    <div class="popbx" id="popbx-@books.FlightID" style="display: none;">
                                                        <button class="close-btn " onclick="closeRefundPopup('@books.FlightID')">&times;</button>

                                                        <table class="table">
                                                            <tbody>
                                                                <tr>
                                                                    <th><strong>Booking Amount:</strong></th>
                                                                    <td><div id="@books.FlightID-1"></div></td>
                                                                </tr>
                                                                <tr>
                                                                    <th><strong>Deduction Amount:</strong></th>
                                                                    <td><div id="@books.FlightID-2"></div></td>
                                                                </tr>
                                                                <tr>
                                                                    <th><strong>Refund Amount:</strong></th>
                                                                    <td><div id="@books.FlightID-3"></div></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>

                                                </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-Completed">
                        <div class="text-center">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Trip ID</th>
                                        <th>Travel Date/Time</th>
                                        <th>PNR Number</th>
                                        <th>Traveller Details</th>
                                        <th>Trip Details</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>

                                    @if (Model != null && Model.Count > 0)
                                    {
                                        @* if(Model[0].) *@
                                        foreach (Booking books in Model.Where(x => x.cancelstatus != 3 && x.DepartureDate < DateTime.Today).ToList())
                                        {
                                            <tr>
                                                <td class="text-center trip-id">
                                                    @{
                                                        string imagePath = books.AirLineID switch
                                                        {
                                                            1 => Url.Content("~/img/flight-logo-icon/AIX_X_Logo_Orange.png"),
                                                            2 => Url.Content("~/img/flight-logo-icon/akasa.png"),
                                                            3 => Url.Content("~/img/flight-logo-icon/SG.png"),
                                                            4 => Url.Content("~/img/flight-logo-icon/6E.png"),
                                                            5 => Url.Content("~/img/flight-logo-icon/airindia.png"),
                                                            _ => Url.Content("~/images/airlines/default.png")
                                                        };
                                                    }
                                                    <img src="@imagePath" alt="Airline Logo" style="height: 30px;" />
                                                    @books.FlightID
                                                </td>
                                                <td class="travel-date"><strong>@Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM")</strong>-@Convert.ToDateTime(books.DepartureDate).ToString("yyyy"),<strong>@Convert.ToDateTime(books.DepartureDate).ToString("HH:mm")</strong> </td>

                                                <td class="pnr-no">@books.RecordLocator</td>
                                                <td class="trv-dtl">@books.Passengers <br /><small>Jetways Travels</small></td>
                                                <td class="trp-dtl">
                                                    Domestic @books.TripType (Online)<br />
                                                    @Convert.ToDateTime(books.DepartureDate).ToString("dd-MMM-yyyy, HH:MM") @books.Origin to @books.Destination |<br />
                                                    @books.Segments | PNR: @books.RecordLocator
                                                </td>

                                                <td class="status-awaiting status" style="color:#EF0000;"><i class="fa fa-times-circle" aria-hidden="true"></i>Complete</td>

                                            </tr>
                                        }
                                    }



                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-Unsuccessful">
                        <div class="text-center">
                            <img class="navbar-brand-regular" src="~/img/booking-not-img.jpg" alt="image" style="height: 250px;">
                            <p class="text-center"><strong>Currently You Have No Bookings.</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- ***** All jQuery Plugins ***** -->
    <!-- Social media js -->
    <script src="~/js/jquery/jquery.min.js"></script>
    <!-- Plugins js -->
    <script src="~/js/plugins/plugins.min.js"></script>

    <!-- ***** Clander js ***** -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>
    <script src="~/js/daterangepicker.js"></script>

    <!-- Bootstrap js -->
    <script src="~/js/bootstrap/popper.min.js"></script>
    <script src="~/js/bootstrap/bootstrap.min.js"></script>
    <!-- Travellers js -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAAz77U5XQuEME6TpftaMdX0bBelQxXRlM"></script>
    <script src="~/js/vendors.js"></script>
    <script src="~/js/main.js"></script>

    <!-- Active js -->
    <script src="~/js/active.js"></script>

    <!-- Clander js -->
    <script type="text/javascript">
        $(document).ready(function () {
            updateConfig();
            function updateConfig() {
                var options = {};
                if ($('#locale').is(':checked')) {
                    $('#rtl-wrap').show();
                    options.locale = {
                        daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
                        monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                        firstDay: 1
                    };
                }

                $('#start-date').daterangepicker(options, function (start, end, label) { console.log('New date range selected: ' + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD') + ' (predefined range: ' + label + ')'); }).click();;

            }

        });

            < !--show and hide-- >

            $('.showBtn').click(function () {
                //$('.hideme').hide();
                if ($(this).hasClass('active')) {
                    $(this).removeClass('active');
                    $('.hideme').slideUp(1);
                } else {
                    $('.hideme').slideUp(1);
                    $('.showBtn').removeClass('active');
                    $(this).addClass('active');
                    $(this).next().filter('.hideme').slideDown(1);
                }
            });

    </script>


    <script>
        $(document).ready(function () {
            $('#filter-one').on('click', function () {
                $(this).toggleClass('slotSelected');
            });

            $('#filter-two').on('click', function () {
                $(this).toggleClass('slotSelected');
            });

            $('#filter-three').on('click', function () {
                $(this).toggleClass('slotSelected');
            });

            $('#filter-four').on('click', function () {
                $(this).toggleClass('slotSelected');
            });

        });
    </script>


    <!-- My booking Search Filter Script -->
    <script>
        $(document).ready(function () {
            $('#search-input').on('keyup', function () {
                var searchText = $(this).val().toLowerCase();
                var activeTab = $('.tab-pane.active');

                activeTab.find('tbody tr').each(function () {
                    var rowText = $(this).text().toLowerCase();
                    $(this).toggle(rowText.indexOf(searchText) > -1);
                });
            });

            // Refresh search results when tab changes
            $('a[data-toggle="pill"]').on('shown.bs.tab', function () {
                $('#search-input').trigger('keyup');
            });
        });
    </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   


    <script>
        function OldViewRefundData(id, pnr) {
            // Show the pop-up box
            document.getElementById("popbx-" + id).style.display = "block";

            $.ajax({
                    url: "/CancelBooking/CancelRefund?flightid=" + encodeURIComponent(id) + "&pnr=" + encodeURIComponent(pnr),
                    type: "GET",
                    contentType: "application/json",
                    success: function (data) {
                       // alert(data);
                        console.log("Refund Data:", data);
                      
                        document.getElementById(id + "-1").innerHTML = data[0].bookingAmount;
                        document.getElementById(id + "-2").innerHTML = data[0].deductionAmount;
                        document.getElementById(id + "-3").innerHTML = data[0].refundAmount;
                        // You can update the DOM here with returned data if needed
                          return false;
                    },
                    error: function (xhr, status, error) {
                         alert(error);
                        console.error("Error:", error);
                    }
                });
            }

            function closeRefundPopup(id) {
            document.getElementById("popbx-" + id).style.display = "none";
        }
    </script>

    <script>
        let page = { active: 1, cancelled: 1, completed: 1 };
        let loading = false;
        const pageSize = 10;

        function loadBookings(tab) {
            if (loading) return;
            loading = true;
            $.get(`/Booking/GetBookingData`, { tab: tab, page: page[tab], pageSize: pageSize })
                .done(data => {
                    if (!data || data.length === 0) return;

                    const $tbody = $(`.tripBody[data-tab="${tab}"]`);
                    data.forEach(booking => {
                        const logo = getAirlineLogo(booking.airLineID);
                        const date = formatDateTime(booking.departureDate);
                        const fullDate = formatDateFull(booking.departureDate);
                        const status = getStatusLabel(tab);
                        const isActive = tab === "active";

                        const row = `
                            <tr>
                                <td class="text-center trip-id"><img src="${logo}" style="height:30px;" /> ${booking.flightID}</td>
                                <td class="travel-date">${date}</td>
                                <td>${booking.recordLocator}</td>
                                <td>${booking.passengers}<br/><small>Jetways Travels</small></td>
                                <td>
                                    Domestic ${booking.tripType} (Online)<br/>
                                    ${fullDate} ${booking.origin} to ${booking.destination}<br/>
                                    ${booking.segments} | PNR: ${booking.recordLocator}
                                </td>
                                <td class="status">${status}</td>
                                <td class="action">
                                    ${isActive ? `
                                        <form method="post" action="/Booking/Cancelbooking?pnr=${booking.recordLocator}&airline=${booking.airLineID}" class="d-inline">
                                            <button type="submit" class="cancel-btn action-btn" style="color: #fff; border: #ddd 1px solid; background: #EF0000;">Manage Booking</button>
                                        </form>` : (tab === "cancelled" ? `
                                        <button class="status-booked" onclick="ViewRefundData('${booking.flightID}', '${booking.recordLocator}')" style="color:#008000;">
                                            <i class="fa fa-check-circle"></i> View Refund
                                        </button>
                                        <div class="popbx" id="popbx-${booking.flightID}" style="display:none;">
                                            <button class="close-btn" onclick="closeRefundPopup('${booking.flightID}')">&times;</button>
                                            <table class="table">
                                                <tr><th>Booking Amount:</th><td><div id="${booking.flightID}"></div></td></tr>
                                                <tr><th>Deduction Amount:</th><td><div id="${booking.flightID}"></div></td></tr>
                                                <tr><th>Refund Amount:</th><td><div id="${booking.flightID}"></div></td></tr>
                                            </table>
                                        </div>` : '')}
                                </td>
                            </tr>`;
                        $tbody.append(row);
                    });

                    page[tab]++;
                    loading = false;
                })
                .fail(err => {
                    console.error("Failed to load bookings:", err);
                    loading = false;
                });
        }

        function getAirlineLogo(id) {
            switch (id) {
                case 1: return "/img/flight-logo-icon/AIX_X_Logo_Orange.png";
                case 2: return "/img/flight-logo-icon/akasa.png";
                case 3: return "/img/flight-logo-icon/SG.png";
                case 4: return "/img/flight-logo-icon/6E.png";
                case 5: return "/img/flight-logo-icon/airindia.png";
                default: return "/images/airlines/default.png";
            }
        }

        function formatDateTime(dateStr) {
            let d = new Date(dateStr);
            return `<strong>${d.toLocaleDateString('en-GB', { day: '2-digit', month: 'short' })}</strong> - ${d.getFullYear()}, <strong>${d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</strong>`;
        }

        function formatDateFull(dateStr) {
            let d = new Date(dateStr);
            return `${d.toLocaleDateString('en-GB')} ${d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
        }

        function getStatusLabel(tab) {
            switch (tab) {
                case "active": return '<span style="color:#008000;"><i class="fa fa-check-circle"></i> Booked</span>';
                case "cancelled": return '<span style="color:#EF0000;"><i class="fa fa-times-circle"></i> Cancelled</span>';
                case "completed": return '<span style="color:gray;"><i class="fa fa-check-circle"></i> Complete</span>';
                default: return '';
            }
        }

        $(document).ready(() => {
            loadBookings('active');

            $('a[data-toggle="pill"]').on('shown.bs.tab', function (e) {
                const tab = $(e.target).attr('id').replace('pills-', '').replace('-tab', '');
                if ($(`.tripBody[data-tab="${tab}"]`).children().length === 0) {
                    loadBookings(tab);
                }
            });

            $(window).on('scroll', () => {
                const tab = $('.tab-pane.show.active .tripBody').data('tab');
                if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
                    loadBookings(tab);
                }
            });
        });

        function ViewRefundData(id, pnr) {
            document.getElementById("popbx-" + id).style.display = "block";
            $.ajax({
                url: "/CancelBooking/CancelRefund?flightid=" + encodeURIComponent(id) + "&pnr=" + encodeURIComponent(pnr),
                type: "GET",
                contentType: "application/json",
                success: function (data) {
                    document.getElementById(id).innerHTML = "<span>" + data.amount + "</span><span>" + pnr + "</span>";
                },
                error: function (xhr, status, error) {
                    console.error("Error:", error);
                }
            });
        }

        function closeRefundPopup(id) {
            document.getElementById("popbx-" + id).style.display = "none";
        }
    </script>


</body>



</html>